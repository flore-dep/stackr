<div class="header tool-header shadow-sm">
  <div class="d-flex justify-content-start">
    <div class="medium-logo-rounded ms-1 mt-1">
      <% if @tool.logo.attached? %>
        <%= cl_image_tag @tool.logo.key, class: "img-fluid rounded-start p-1" %>
      <% else %>
        <%= image_tag "logos/default-logo.jpg", class: "img-fluid rounded-start p-1" %>
      <% end %>
    </div>
    <div class="m-2 mt-1">
      <div class="d-flex align-items-center gap-2">
        <h5 class="m-0"><%= @tool.name %></h5>
        <a href="<%= @tool.website %>" target="_blank" title="Aller sur le site !">
          <i class="fa-solid fa-link me-2"></i>
        </a>
        <% if @tool.reviews.any? %>
          <div class="d-flex align-items-center">
            <span class="me-1"><%= @tool.reviews.average(:rating) %></span>
            <i class="fa-solid fa-star text-warning"></i>
          </div>
        <% else %>
          <span class="me-1">No ratings</span>
        <% end %>
      </div>
      <div class="mt-3 mb-4">
        <p><%= @tool.description %></p>
      </div>
      <div>
        <div class="me-2 mb-2">
          <p class="px-3 py-1 m-0"><%= @tool.category %></p>
        </div>
      </div>
    </div>
    <div class="d-flex flex-column align-items-end mt-4 me-4 ms-auto">
      <div>
        <% if user_signed_in? %>
          <% if @existing_license.present? == false %>
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
              Add to your stack
            </button>
          <% elsif @end_date_validity == false %>
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
              Renew your license
            </button>
          <% else %>
            <button type="button" class="btn btn-secondary disabled" data-bs-toggle="modal" data-bs-target="#exampleModal">
              Already in your stack
            </button>
          <% end %>
        <% else %>
          <button type="button" class="btn btn-secondary disabled" data-bs-toggle="modal" data-bs-target="#exampleModal">
            Sign-in to enable
          </button>
        <% end %>
      </div>
    </div>
  </div>
  <div class="ms-5 me-4">
    <p><%= @tool.long_description %></p>
  </div>
</div>

<div class="container tool-container w-75 my-5">
  <h4>Reviews</h4>
  <% if @tool.reviews.any? %>
    <ul class="list-group list-group">
      <% @tool.reviews.each do |review| %>
        <li class="list-group-item d-flex justify-content-between align-items-start">
          <div>
            <%= image_tag("Kermit.JPG", width: "40", class: "rounded-circle") %>
          </div>
          <div class="ms-2 me-auto">
            <div class="fw-bold"><%= review.username %></div>
            <div class="text-break text-muted"><%= review.content %></div>
          </div>
          <span class="badge bg-primary rounded-pill"><%= review.rating %>/5</span>
        </li>
      <% end %>
    </ul>
  <% else %>
    <p class="text-muted">This product has not been reviewed yet</p>
  <% end %>
</div>
